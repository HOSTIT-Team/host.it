<div class="event-container">
  <% if @event.banner.attached? %>
    <div class="event-banner" style="background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('<%= cl_image_path @event.banner.key %>')"> 
  <% else %>
    <div class="event-banner">
  <% end %>
  <% if @event.user == current_user || current_user.admin? %>
      <%= link_to edit_event_path(@event), class: "button-create upload-button" do %>
        <i class="far fa-edit"></i>
      <% end %>
  <% end %>
    </div>

  <div class="event-details">
    <div class="event-info">
      <% if @event.user == current_user || current_user.admin? %>
      <div id="event-edit-delete">
        <%= link_to edit_event_path(@event), title: "Edit event", id: "event-edit" do %>
          <i class="fas fa-edit"></i>
        <% end %>
        <%= link_to event_path(@event), title: "Delete event", method: :delete, id: "event-delete" do %>
          <i class="fas fa-trash"></i>
        <% end %>
      </div>
    <% end %>
    <h1 id="event-title"><%= @event.title %></h1>
    <p id="event-time-location"><i class="fas fa-map-marker-alt"></i> <%= @event.location %> <i class="fas fa-clock"></i> <%= @event.scheduled_at.strftime("%d %b %Y") %> at <%= @event.scheduled_at.strftime("%H:%M %p") %></p>
    <p id="event-description"><%= @event.description %></p>
    </div>
    <div class="event-host">
      <h1 class="host-title event-title">Your Host</h1>
      <% if @event.user.avatar.attached? %>
        <div class="host-avatar tilt" style="background-image: url('<%= cl_image_path @event.user.avatar.key %>')"></div>
      <% else %>
        <div class="host-avatar">?</div>
      <% end %>
      <div class="host-info">
        <div class="host-name"><%= link_to @event.user.full_name, user_path(@event.user) %></div>
      </div>
    </div>
  </div>

  <div class="event-guest-map">
    <div class="guest-list">
      <div class="guest-list-header">The Guests</div>
      <div class="slider-area">
        <% @event.invitations.each do |invitation| %>
          <% if invitation.receiver && (invitation.status == "pending" || invitation.status == "accepted") %>
            <div class="slide">
              <div class="guest-cards">
                  <% if invitation.receiver.avatar.attached? %>
                    <%= cl_image_tag invitation.receiver.avatar.key %>
                  <% else %>
                    <%= image_tag "placeholder-avatar.png"%>
                  <% end %>
              </div>
              <% if invitation.receiver && invitation.receiver.first_name && invitation.receiver.last_name %>
                <div class="guest-name"><%= link_to invitation.receiver.full_name, user_path(invitation.receiver) %></div>
              <% else %>
                <div class="guest-name"><%= link_to "Nemo", user_path(invitation.receiver) %></div>
              <% end %>
            </div>
           <% end %>
        <% end %>
      </div>
      <a href="" class="list-button button-invite">See list</a>
    
    </div>
    
      <div id="map"
        data-markers="<%= @marker.to_json %>"
        data-mapbox-api-key="<%= ENV["MAPBOX_API_KEY"]%>">
      </div>

    <div class="invite-modal">
      <div class="invite-content">
        <% if current_user == @event.user %>
        <div class="invite-form-container">
          <div class="invite-email-input">
            <%= simple_form_for([@event, @invitation]) do |f| %>
              <%= f.input :receiver_email, label: false, placeholder: "Send invite via e-mail" %>
              <%= button_tag type: :submit, class: "invite-button" do %>
                <i class="far fa-paper-plane"></i>
              <% end %>
            <% end %>
          </div>
          <div class="invite-link-container">
            <div class="event-url"><%= "http://hostit.club/events/#{@event.id}" %></div>
            <div class="event-url-copy">Copy link</div>
          </div>
        </div>
        <hr>
        <% end %>
        <div class="invitations">
          <% @invitations.each do |invitation| %>
          <div class="invitee">
            <% if invitation.receiver && invitation.receiver.avatar.attached? %>
              <%= link_to "", user_path(invitation.receiver), class: "receiver-avatar", style: "background-image: url('#{cl_image_path invitation.receiver.avatar.key }')" %>
            <% else %>
              <% if invitation.receiver %>
                <%= link_to "?", user_path(invitation.receiver), class: "receiver-no-avatar" %>
              <% else %>
                <div class="receiver-avatar">?</div>
              <% end %>
            <% end %>
            <div class="invitee-info">
              <% if invitation.receiver && invitation.receiver.first_name && invitation.receiver.last_name %>
                <div class="receiver-fullname">
                  <%= link_to "#{invitation.receiver.first_name} #{invitation.receiver.last_name}", user_path(invitation.receiver) %>
                </div>
                <div class="receiver-mail"><%= invitation.receiver.email %></div>
              <% else %>
                <%= invitation.receiver_email %>
              <% end %>
            </div>
            <div class="invitee-status">
              <% case invitation.status %>
              <% when "accepted" %>
                <div class="invitation-status-accepted">Accepted</div>
              <% when "pending" %>
                <div class="invitation-status-pending">Pending</div>
              <% when "declined" %>
                <div class="invitation-status-declined">Declined</div>
              <% end %>
            </div>
            <% if @event.user == current_user %>
            <div class="invite-delete">
              <%= link_to invitation_path(invitation), title: "Delete invitation", method: "delete" do %>
                <i class="far fa-trash-alt"></i>
              <% end %>
            </div>
            <% end %>
          </div>
        <% end %>
        </div>
        <button id="close-button"><i class="far fa-window-close"></i></button>
      </div>
    </div>
    <div id="button-map">
    <a href="https://www.google.com/maps/search/?api=1&query=<%= @event.latitude %>,<%= @event.longitude %>" target="_blank", class="button-map">Open Google Maps</a>
    </div>
  </div>

  <div class="event-items-playlist">
    <div class="bring-list">
      <div class="items">
      </div>
      <div class="bring-form">
          <input id="item-input" type="text" placeholder="Add what you will bring!">
          <div class="add-item" >
            <%= link_to do %>
                <i class="far fa-plus-square"></i>
            <% end %>
          </div>
      </div>
    </div>
    <div class="playlist">
    <iframe src="https://open.spotify.com/embed/playlist/0K0RsJ0xxaTDZIKQ1vszY3" width="300" height="380" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>
    </div>
  </div>

  <div class="event-chat"> 
    <div class="chat-box">
    </div>
    <div class="chat-form">
      <input id="chat-input" type="text" placeholder="Talk to the other guests here...">
            <div class="send-button" >
              <%= link_to do %>
                  <i class="far fa-paper-plane"></i>
              <% end %>
            </div>
    </div>
  </div>
</div>